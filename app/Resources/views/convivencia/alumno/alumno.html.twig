{% extends 'base2.html.twig' %}

{% block body %}
    {% include 'convivencia/navegacion.html.twig' %}
    <script>(function (e, t, n) {
            var r = e.querySelectorAll("html")[0];
            r.className = r.className.replace(/(^|\s)no-js(\s|$)/, "$1js$2")
        })(document, window, 0);</script>
    <div class="">
        <h3 class="center azul-prof fuente">{{ alumnoData.alumno.getNombreCompleto() }}</h3>
        <h4 class="center fuente" id="punto">Puntos: <span style="margin-top: -10px; font-size: 2rem;">{{ alumnoData.alumno.puntos }}</span>/10</h4>

        {% for flash_message in app.session.flashBag.get('alumno') %}
            <div class="w3-panel w3-pale-green w3-round-large">
                <p class="w3-center">{{ flash_message }}</p>
            </div>
        {% endfor %}

        {% for flash_message in app.session.flashBag.get('alumnoError') %}
            <div class="w3-panel w3-pale-red w3-round-large">
                <p class="w3-center">{{ flash_message }}</p>
            </div>
        {% endfor %}
        <div class="row" id="row1">
            <div class="w3-col l6 marginTopNoMobile">
                <header class="w3-container marginTopNoMobile">
                    {#<img class="w3-circle" src="https://www.w3schools.com/w3css/img_avatar3.png" style="width: 300px"#}
                    {#alt="avatar">#}
                    {% if alumnoData.alumno.foto == "" or alumnoData.alumno.foto == null %}
                        <img class="responsive-img circle" src="{{ asset('img/alumnos/'~alumnoData.alumno.nie~'.PNG') }}"
                             alt="avatar">
                    {% else %}
                        <img class="responsive-img circle" src="{{ asset('img/alumnos/'~alumnoData.alumno.foto) }}"
                             alt="avatar">
                    {% endif %}
                </header>
                <div class="w3-container w3-center">
                    {#<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/84/EAN13.svg/220px-EAN13.svg.png"#}
                    {#style="width:150px;">#}
                    {% if alumnoData.alumno.idUsuario.id == app.user.id %}
                        <form method="post" action="{{ path('change_image') }}" enctype="multipart/form-data">
                            <div class="content">
                                <div class="box">
                                    <input type="file" accept="image/*" name="file" id="file"
                                           class="inputfile inputfile-1" hidden capture="camera">
                                    <label for="file" class="btn z-depth-3 blue darken-3 waves-effect waves-light">
                                        <span style="margin-top: -5%;box-sizing: unset;"> Subir Imagen (2MB) <i class="material-icons">file_upload</i></span>
                                    </label>
                                </div>
                            </div>
                        </form>
                    {% endif %}
                </div>
            </div>
            <div class="w3-col l6" style="display: none;">
                <div class="w3-row w3-center w3-text-center widthChartMobile">
                    <div class="w3-content marginBottom marginTopNoMobile">
                        <h4>Estadísticas Totales {{ alumnoData.getYear() }}</h4>
                        <canvas id="myChart" width="400" height="400"></canvas>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col s12 m6">
                <h4 class="w3-padding">Partes {{ alumnoData.getYear() }}</h4>
                <canvas id="myChart2"></canvas>
            </div>
            <div class="col s12 m6">
                <h4 class="w3-padding">Sanciones {{ alumnoData.getYear() }}</h4>
                <canvas id="myChart3"></canvas>
            </div>
        </div>
        {% set arrMeses = [] %}
        {% set arrPartes = [] %}
        {% for mes, partesMes in alumnoData.numPartesMeses %}
            {% set arrMeses = arrMeses|merge([mes]) %}
            {% set arrPartes = arrPartes|merge([partesMes]) %}
        {% endfor %}
        {% set arrMesesSanciones= [] %}
        {% set arrSanciones = [] %}
        {% for mes, sancionesMes in alumnoData.numSancionesMeses %}
            {% set arrMesesSanciones = arrMesesSanciones|merge([mes]) %}
            {% set arrSanciones = arrSanciones|merge([sancionesMes]) %}
        {% endfor %}
        {% if arrMeses|length > 4 %}
            {% set barPercentage = 0.4 %}
        {% else %}
            {% set barPercentage = 0.2 %}
        {% endif %}
        <script>
            var ctx = document.getElementById("myChart").getContext('2d');
            var myChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    datasets: [{
                        data: [{{ alumnoData.numPartes }}, {{ alumnoData.numSanciones }}, {{ alumnoData.numVisitasConvivencia }}],
                        backgroundColor: [
                            'rgba(54, 162, 235, 0.5)',
                            'rgba(153, 102, 255, 0.5)',
                            'rgba(255, 159, 64, 0.5)',
                            'rgba(153, 102, 255, 0.5)',
                            'rgba(56, 136, 155, 0.5)',
                            'rgba(75, 192, 192, 0.5)',
                            'rgba(255, 206, 86, 0.5)'
                        ],
                    }],


                    labels: [
                        'Partes',
                        'Sanciones',
                        'Visitas Aula Convivencia'
                    ]
                }
            });

            ctx = document.getElementById("myChart2").getContext('2d');
            var myChart2 = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: {{ arrMeses|json_encode|raw }},
                    datasets: [
                        {
                            label: 'Partes',
                            data: {{ arrPartes|json_encode|raw }},
                            backgroundColor: 'rgba(56, 136, 155, 0.5)',
//                         backgroundColor: [
//                            'rgba(56, 136, 155, 0.5)',
//                            'rgba(255, 206, 86, 0.5)',
//                            'rgba(75, 192, 192, 0.5)',
//                            'rgba(153, 102, 255, 0.5)',
//                            'rgba(54, 162, 235, 0.5)',
//                            'rgba(255, 159, 64, 0.5)'
//                    ],
                        },
                        {#{#}
                        {#label: 'Visitas Aula Convivencia',#}
                        {#data: {{ arrPartes|json_encode|raw }},#}
                        {#backgroundColor: 'rgba(75, 192, 192, 0.5)',#}
                        {#}#}
                    ],
                },
                options: {
                    scales: {
                        xAxes: [{
                            barPercentage: {{ barPercentage }}
                        }],
                        yAxes: [{
                            ticks: {
                                beginAtZero: true
                            },
                        }],
                    }
                }
            });

            ctx = document.getElementById("myChart3").getContext('2d');
            var myChart3 = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: {{ arrMesesSanciones|json_encode|raw }},
                    datasets: [
                        {
                            label: 'Sanciones',
                            data: {{ arrSanciones|json_encode|raw }},
                            backgroundColor: 'rgba(153, 102, 255, 0.5)',
                        },
                    ],
                },
                options: {
                    scales: {
                        xAxes: [{
                            barPercentage: {{ barPercentage }}
                        }],
                        yAxes: [{
                            ticks: {
                                beginAtZero: true
                            },
                        }],
                    }
                }
            });

        </script>

        <div class="row">
            <div class="col s12 m6">
                <div class="card white darken-1">
                    <div class="card-content black-text">
                        <span class="card-title center ">Histórico Partes</span>
                        {% set contadorPartes = 0 %}
                        {% set break = false %}
                        {% for parte in alumnoData.partes if not break %}
                            <p style="margin-bottom: 2%">El {{ parte.fecha|date('d/m/Y') }} tuvo una falta {{ parte.idTipo.tipo }}
                                , {{ parte.idProfesor.getNombreCompleto() }} indicó: <br/>
                                {{ parte.descripcion }}</p>
                        {% endfor %}
                    </div>
                </div>
            </div>
            <div class="col s12 m6">
                <div class="card white darken-1">
                    <div class="card-content black-text">
                        <span class="card-title center">Histórico Sanciones</span>
                    {% set contadorSanciones = 0 %}
                    {% set break = false %}
                    {% for sancion in alumnoData.sanciones if not break %}
                        {% set contadorSanciones = contadorSanciones + 1 %}
                        <p style="margin-bottom: 2%">El {{ sancion.fecha|date('d/m/Y') }} tuvo una sanción de
                            tipo {{ sancion.idTipo.tipo }}<br/>sanción: {{ sancion.sancion }}</p>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
    </div>


    <script src="{{ asset('js/fileInput/custom-file-input.js') }}"></script>
{% endblock %}
